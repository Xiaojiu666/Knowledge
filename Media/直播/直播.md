##  前言


##  直播流程

| 流程          |  详细操作  |
|:-------------|:---|
| 音视频数据采集 |   通过摄像头和麦克风采集 |
| 音视频滤镜     |  通过 OpenGL 和 SoundTouch 等工具实现音视频编辑  |
| 音视频编码     |  通过系统硬编码 或 FFmpeg 软编码，将数据编码为 H264 和 AAC  |
| 数据封装打包   |  将编码好的数据封装成指定的格式  |

-   推流
    推流，是直播中的一个术语，意思是将流媒体数据推送到服务器。如何推流，关键就在于使用的推流协议。

-   拉流
    拉流，指的是「观众端」流媒体数据的拉取，同样也需要通过约定的拉流协议来拉取。

##  直播协议
-   RTMP
    RTMP 全名：Real Time Messaging Protocol，实时消息传送协议。是 Adobe 公司开发的，用于 Flash Player 和服务器间之间传输音视频数据。RTMP 是基于 TCP 开发的，属于应用层的协议，默认端口为 1935 。
    RTMP 主要特点是实时性好，延时比较低（1～3s）。既可以用来推流，也可以用来拉流。

    但是由于其基于 TCP 长链接协议，默认端口非公共端口，可能会被防火墙拦截。

-   HTTP-FLV
    HTTP-FLV，从其命名可以大概看出工作模式。即：将音视频数据封装为 flv 格式，通过 HTTP 长链接协议传输。既然是基于 HTTP ，其默认端口就是 80，可以直接穿透防火墙。

    其传输方式和 RTMP 一样，只是将协议更换为 HTTP，所以实时性也比较好。

    由于 HTTP-FLV 的特点，非常适合用于 App 直播拉流。

-   HLS

    HLS：HTTP Live Streaming。是苹果公司推出的基于 HTTP 的流媒体传输协议，视频封装格式是 ts，在 iOS 和 Mac 支持比较好。
    与 RTMP 和 HTTP-FLV 不同的是，HSL 是切片传输，它会将视频切为一个个小的 ts 文件，并将切片信息记录在 .m3u8 文件中。
    拉流客户端根据 .m3u8 中的 ts 索引信息，按顺序下载播放。

    由于其切片的特点，会导致比较大的延迟，在实时性要求比较高的情况下，效果不好。

    以上，就是在直播系统中经常使用到的三大协议。


##  参考资料
-   https://blog.csdn.net/ddr77/article/details/54349004           //rtmp 协议中对视频格式的封装
-   https://www.jianshu.com/p/4f2271465b9c                         //移动直播技术知多少：基础原理解析 & 腾讯云直播接入
-   https://www.jianshu.com/p/f116b6f81ab3                         //直播技术点之编解码基础（一）—— 硬编码之MediaCodec